name: compile dztech dz60rgb WKL v2's VIA keymap

on:
  push:
    tags:
      - "dz60rgb-wkl-v2-via-v*.*.*"

jobs:
  compile-dztech-dz60rgb-wkl-v2-via-keymap:
    runs-on: ubuntu-20.04
    container:
      image: qmkfm/qmk_firmware
    steps:
      - uses: actions/checkout@v2
      - name: Copy planck directory
        run: cp -r ./dztech-dz60rgb-wkl-v2-via /qmk_firmware/keyboards/dztech/dz60rgb_wkl/keymaps/via-jonz94
      - name: Change working directory to /qmk_firmware
        run: cd /qmk_firmware
      - name: Compile
        run: qmk compile -kb dztech/dz60rgb_wkl/v2 -km via-jonz94
      - name: Rename compiled hex file
        run: mv /qmk_firmware/dztech_dz60rgb_wkl_v2_via-jonz94.hex /qmk_firmware/dztech-dz60rgb-wkl-v2-via-jonz94.hex
      - uses: actions/upload-artifact@master
        with:
          name: dztech dz60rgb WKL v2's VIA by jonz94
          path: "/qmk_firmware/dztech-dz60rgb-wkl-v2-via-jonz94.hex"
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: "/qmk_firmware/dztech-dz60rgb-wkl-v2-via-jonz94.hex"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
